# Руководство по фронтенду переходов между статусами

## Обзор

Система переходов между статусами предоставляет полнофункциональный пользовательский интерфейс для управления workflow тикетов в service desk системе.

## Компоненты

### 1. WorkflowTransitions

**Расположение:** `frontend/src/components/WorkflowTransitions.js`

**Функциональность:**
- Отображение текущего статуса тикета
- Показ доступных переходов для текущего пользователя
- Выполнение переходов с поддержкой комментариев и назначения
- Валидация прав доступа
- Обработка ошибок

**Основные возможности:**
- ✅ Простые переходы (одним кликом)
- ✅ Переходы с обязательными комментариями
- ✅ Переходы с назначением исполнителя
- ✅ Цветовая индикация статусов и переходов
- ✅ Иконки для визуального представления
- ✅ Загрузочные состояния и индикаторы прогресса

### 2. WorkflowHistory

**Расположение:** `frontend/src/components/WorkflowHistory.js`

**Функциональность:**
- Отображение истории всех переходов по тикету
- Временная шкала с визуальными индикаторами
- Детальная информация о каждом переходе
- Пагинация для больших объемов данных
- Переключатель детального режима

**Основные возможности:**
- ✅ Хронологическая лента событий
- ✅ Информация о пользователях, выполнивших переходы
- ✅ Отображение успешных и неуспешных переходов
- ✅ Детали выполнения (условия, действия, метаданные)
- ✅ Время выполнения переходов
- ✅ Пагинация с настраиваемым количеством записей

## Интеграция в TicketDetails

Компоненты интегрированы в страницу деталей тикета (`frontend/src/pages/TicketDetails.js`):

```jsx
{/* Workflow Transitions Card */}
<Card sx={{ mt: 2 }}>
  <CardContent>
    <WorkflowTransitions
      ticketId={id}
      currentUser={user}
      onTransitionExecuted={(result) => {
        // Автоматическое обновление данных тикета
        fetchTicketDetails();
      }}
    />
  </CardContent>
</Card>

{/* Workflow History Card */}
<Card sx={{ mt: 2 }}>
  <CardContent>
    <WorkflowHistory ticketId={id} />
  </CardContent>
</Card>
```

## API Endpoints

### Получение доступных переходов
```
GET /api/tickets/:id/transitions/available
```

**Ответ:**
```json
{
  "transitions": [
    {
      "id": "uuid",
      "name": "start_work",
      "displayName": {
        "ru": "Начать работу",
        "en": "Start Work"
      },
      "icon": "play",
      "color": "#28a745",
      "requiresComment": false,
      "requiresAssignment": true,
      "toStatus": {
        "id": "uuid",
        "name": "in_progress",
        "displayName": {
          "ru": "В работе",
          "en": "In Progress"
        },
        "color": "#ffc107"
      }
    }
  ],
  "currentStatus": {
    "id": "uuid",
    "name": "new",
    "displayName": {
      "ru": "Новая",
      "en": "New"
    },
    "color": "#17a2b8"
  },
  "workflowType": {
    "id": "uuid",
    "name": "incident_workflow",
    "displayName": {
      "ru": "Workflow инцидентов",
      "en": "Incident Workflow"
    }
  }
}
```

### Выполнение перехода
```
POST /api/tickets/:id/transitions/:transitionId/execute
```

**Тело запроса:**
```json
{
  "comment": "Начинаю работу над тикетом",
  "assigneeId": "user-uuid",
  "context": {
    "priority": "high",
    "category": "technical"
  }
}
```

### Получение истории переходов
```
GET /api/tickets/:id/workflow/history?page=1&limit=20&includeDetails=true
```

## Стилизация

### WorkflowTransitions.css
- Современный дизайн с градиентами и тенями
- Анимации hover-эффектов
- Адаптивная верстка
- Цветовая индикация статусов

### WorkflowHistory.css
- Временная шкала с визуальными индикаторами
- Карточки событий с детальной информацией
- Пагинация в стиле Material Design
- Адаптивные стили для мобильных устройств

## Права доступа

### Клиенты (role: 'client')
- Могут видеть переходы только для своих тикетов
- Ограниченный набор доступных переходов
- Не могут назначать исполнителей

### Агенты (role: 'agent')
- Полный доступ к переходам
- Могут назначать исполнителей
- Видят все детали workflow

### Администраторы (role: 'admin')
- Полный доступ ко всем функциям
- Могут выполнять любые переходы
- Доступ к административным функциям workflow

## Обработка ошибок

Система включает комплексную обработку ошибок:

- **Сетевые ошибки:** Автоматические повторы и уведомления
- **Ошибки валидации:** Подсветка проблемных полей
- **Ошибки прав доступа:** Информативные сообщения
- **Ошибки workflow:** Детальное описание проблем

## Производительность

### Оптимизации
- Ленивая загрузка истории переходов
- Кэширование доступных переходов
- Дебаунсинг пользовательского ввода
- Минимизация перерисовок компонентов

### Мониторинг
- Логирование всех действий пользователя
- Метрики времени выполнения переходов
- Отслеживание ошибок и их частоты

## Будущие улучшения

### Планируемые функции
- [ ] Массовые переходы для нескольких тикетов
- [ ] Настраиваемые уведомления о переходах
- [ ] Экспорт истории переходов
- [ ] Графическое представление workflow
- [ ] Автоматические переходы по расписанию

### Технические улучшения
- [ ] WebSocket для real-time обновлений
- [ ] Оффлайн режим с синхронизацией
- [ ] Улучшенная мобильная версия
- [ ] Интеграция с внешними системами

## Заключение

Фронтенд переходов между статусами предоставляет полнофункциональный и удобный интерфейс для управления workflow тикетов. Система спроектирована с учетом современных принципов UX/UI и обеспечивает высокую производительность и надежность.

Функциональность готова к использованию и может быть легко расширена для дополнительных требований бизнеса.